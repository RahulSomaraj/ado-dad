# Chat Testing Frontend Guide

## Overview

This guide provides instructions for testing the chat functionality using the provided HTML frontend. The frontend allows you to test real-time messaging between users based on ad ID and user ID.

## Files Created

1. **`chat-test-frontend.html`** - Main chat testing interface
2. **`chat-test-helper.js`** - Helper script for generating test data and URLs
3. **`CHAT_TESTING_GUIDE.md`** - This guide

## Quick Start

### 1. Start Your NestJS Server

```bash
npm run start:dev
```

### 2. Generate Test URLs

```bash
node chat-test-helper.js
```

This will output test URLs for different users that you can open in your browser.

### 3. Open the Frontend

Open `chat-test-frontend.html` in your browser, or use one of the generated URLs.

## Features

### ðŸ”Œ Connection Management

- Connect/disconnect to WebSocket server
- Real-time connection status indicator
- JWT token authentication support

### ðŸ’¬ Chat Functionality

- Create new ad-based chats
- Send and receive real-time messages
- View chat history
- Mark messages as read
- Multiple chat support

### ðŸŽ¯ Testing Capabilities

- Test with multiple users simultaneously
- Simulate ad-based conversations
- Real-time message synchronization
- Error handling and logging

## Testing Scenarios

### Scenario 1: Basic Chat Creation

1. Open the frontend in two different browser windows/tabs
2. Connect as different users in each window
3. Create a chat for the same ad
4. Send messages between users
5. Verify real-time message delivery

### Scenario 2: Multiple Chats

1. Create multiple chats for different ads
2. Switch between chats
3. Verify message isolation between chats
4. Test chat list functionality

### Scenario 3: Error Handling

1. Disconnect and reconnect
2. Test with invalid user IDs
3. Test with invalid ad IDs
4. Verify error messages and recovery

## API Endpoints Tested

The frontend tests the following WebSocket events:

### Client to Server

- `connect` - Establish connection
- `createAdChat` - Create new ad-based chat
- `getUserChats` - Get user's chat list
- `joinChat` - Join a specific chat room
- `sendMessage` - Send a message
- `getChatMessages` - Get chat history
- `markAsRead` - Mark messages as read

### Server to Client

- `connect` - Connection established
- `disconnect` - Connection lost
- `newMessage` - New message received
- `connect_error` - Connection error

## REST API Testing

You can also test the REST endpoints using cURL commands generated by the helper script:

```bash
# Create ad chat
curl -X POST http://localhost:3000/chat/ad/AD_ID \
  -H "Authorization: Bearer JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"adPosterId": "POSTER_ID"}'

# Get user chats
curl -X GET http://localhost:3000/chat/user \
  -H "Authorization: Bearer JWT_TOKEN"

# Get chat messages
curl -X GET http://localhost:3000/chat/CHAT_ID/messages \
  -H "Authorization: Bearer JWT_TOKEN"

# Send message
curl -X POST http://localhost:3000/chat/CHAT_ID/messages \
  -H "Authorization: Bearer JWT_TOKEN" \
  -H "Content-Type: application/json" \
  -d '{"content": "Hello!"}'
```

## Test Data

The helper script provides the following test data:

### Users

- John Doe (ID: 507f1f77bcf86cd799439011)
- Jane Smith (ID: 507f1f77bcf86cd799439012)
- Bob Johnson (ID: 507f1f77bcf86cd799439013)

### Ads

- Toyota Camry 2020 (ID: 507f1f77bcf86cd799439021)
- Honda Civic 2019 (ID: 507f1f77bcf86cd799439022)
- Ford Mustang 2021 (ID: 507f1f77bcf86cd799439023)

## Usage Instructions

### 1. Setup Tab

1. Enter your server URL (default: http://localhost:3000)
2. Enter your user ID
3. Enter your JWT token (optional for testing)
4. Click "Connect" to establish WebSocket connection
5. Enter Ad ID and Ad Poster ID
6. Click "Create Ad Chat" to start a new chat

### 2. Chats Tab

1. Click "Refresh Chats" to load your chat list
2. Click on any chat to select it
3. The chat area will show the selected chat

### 3. Messaging

1. Select a chat from the list
2. Type your message in the input field
3. Press Enter or click "Send"
4. Messages appear in real-time
5. Use "Mark as Read" to mark messages as read

## Troubleshooting

### Connection Issues

- Verify your server is running on the correct port
- Check that WebSocket is enabled in your NestJS app
- Ensure CORS is properly configured

### Authentication Issues

- Verify your JWT token is valid
- Check that the user ID matches the token
- Ensure the auth guard is properly configured

### Message Issues

- Verify you're connected to the WebSocket
- Check that you've selected a chat
- Ensure the chat ID is valid

### Real-time Issues

- Check browser console for WebSocket errors
- Verify Socket.IO client version compatibility
- Ensure no firewall is blocking WebSocket connections

## Advanced Testing

### Multiple Users

To test with multiple users:

1. Open multiple browser windows
2. Use different user IDs for each window
3. Connect all users to the same server
4. Create chats and test messaging between users

### Load Testing

For load testing:

1. Open many browser windows
2. Connect multiple users simultaneously
3. Send messages rapidly
4. Monitor server performance and memory usage

### Network Testing

To test network resilience:

1. Disconnect network while messaging
2. Reconnect and verify message delivery
3. Test with slow network connections
4. Verify reconnection handling

## Security Considerations

### Testing Only

- The frontend is for testing purposes only
- Mock JWT tokens are not cryptographically secure
- Do not use in production environments

### Data Privacy

- Test data is not persisted in the frontend
- Messages are stored in your MongoDB database
- Clear test data after testing

## Customization

### Adding New Test Users

Edit `chat-test-helper.js` to add new test users:

```javascript
users: [
  { id: 'NEW_USER_ID', name: 'New User', email: 'newuser@example.com' },
  // ... existing users
];
```

### Modifying Test Ads

Add new test ads:

```javascript
ads: [
  { id: 'NEW_AD_ID', title: 'New Ad Title', posterId: 'POSTER_ID' },
  // ... existing ads
];
```

### Custom Server URL

Change the default server URL in the frontend or pass it as a URL parameter:

```
chat-test-frontend.html?server=http://your-server:3000
```

## Support

If you encounter issues:

1. Check the browser console for errors
2. Verify your NestJS server logs
3. Ensure all dependencies are installed
4. Check WebSocket configuration in your NestJS app

## Next Steps

After testing the basic functionality:

1. Integrate with your Flutter app
2. Add push notifications for new messages
3. Implement message encryption
4. Add file/image sharing capabilities
5. Implement typing indicators
6. Add message reactions and replies
